# Process Thread Coroutine

![](../.gitbook/assets/协程.jpeg)



* 一个进程可以拥有一个或者多个线程，线程只存在于一个进程里。
* 进程有自己的地址空间，占据独立内存，资源共享复杂，切换开销大，同步简单；线程间资源共享容易，同步需要加锁。
* 协程是一种用户态的轻量级线程，保留上一次调用状态，无需上下文切换开销。
* 线程协程适合IO密集型应用，多进程适合CPU计算密集型应用以利用多核。



## 乐观锁和悲观锁

* 乐观锁：不上锁，更新时检查数据是否被修改过，修改过则放弃操作
  * Compare And Swap(CAS)：VAB，如果内存位置V的值等于预期值A，则位置更新为新值B，否则不执行操作，自旋（重试至成功）；限制：单个变量原子性，ABA问题（即修改为原来的数据，栈顶问题，可加版本号解决）
  * 版本号：修改version++，更新时version?=读取时version
* 悲观锁：总加锁，block其他线程

适用于不同场景，如乐观锁适合多读应用类型以提高吞吐量，避免使用于并发冲突概率高的场景下一直重试导致CPU开销较大

[https://www.cnblogs.com/kismetv/p/10787228.html](https://www.cnblogs.com/kismetv/p/10787228.html)





